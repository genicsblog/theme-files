<script src="{{ site.baseurl }}/assets/js/theme.js" data-no-instant></script>
<script src="{{ site.baseurl }}/assets/js/search.js" data-no-instant></script>
<script src="{{ site.baseurl }}/assets/js/prism.js" data-no-instant></script>
<script src="{{ site.baseurl }}/assets/js/instantclick.min.js" data-no-instant></script>
<script data-no-instant>
  InstantClick.on("change", () => {
    // apply color scheme
    setTheme();

    Prism.highlightAll();
    initCodeBlocks();

    window.onscroll = () => {
      setStickyness();
    };

    document
    .getElementById("search-container")
    .addEventListener("click", (event) => {
      if (event.target.id === "search-container") {
        hideSearch();
      }
    });

    {% if jekyll.environment == "production" %}
    const path = window.location.pathname + window.location.search + window.location.hash;
    gtag("set", "page_path", path);
    {% endif %}

    // pause already playing Audios
    if(window.BwPlayer && typeof window.BwPlayer.pause === 'function') {
      window.BwPlayer.pause();
    }
    
    const audioPlayer = document.getElementById("audio-player");
    if(audioPlayer) {
      // hack to support SPAs with BeyondWords
      const audioScript = document.createElement("script");
      audioScript.type = "module";
      audioScript.text = `import BeyondWords from 'https://proxy.beyondwords.io/npm/@beyondwords/audio-player@latest/dist/module/index.js'

      BeyondWords.sdk.player({
        renderNode: 'audio-player',
        projectId: 11987,
        podcastId: ${audioPlayer.dataset.audioId},
      }).then(appInst => {
        window.BwPlayer = appInst;
        const player = document.getElementsByClassName("sk-app-container")[0];
        player.classList.add("rounded-xl");
        const attribution = document.getElementsByClassName("sk-app-link")[0];
        attribution.classList.add("underline-none");
      });`;

      document.body.appendChild(audioScript);
    }
  });

  InstantClick.init("mousedown");
</script>